<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%232563eb;stop-opacity:1' /%3E%3Cstop offset='50%25' style='stop-color:%2316a34a;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%23ea580c;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='32' height='32' rx='6' fill='url(%23grad)'/%3E%3Ctext x='16' y='22' font-family='system-ui,-apple-system,sans-serif' font-size='16' font-weight='500' text-anchor='middle' fill='white'%3EN%3C/text%3E%3C/svg%3E">
    <title>Blog - Navajit D</title>
    <style>
        :root {
            --text-color: #0a1f00; --bg-color: #fff; --accent-color: #2563eb;
            --muted-color: #6b7280; --border-color: #e5e7eb;
            --font-sans: "Inconsolata", monospace; --secondary-color: #374151;
        }
        [data-theme="colorful"] {
            --text-color: #0f2e00; --bg-color: #fefffe; --accent-color: #16a34a;
            --muted-color: #65a30d; --border-color: #bbf7d0; --secondary-color: #ea580c;
        }
        *{box-sizing:border-box;margin:0;padding:0} html{font-size:16px}
        body{font-family:var(--font-sans);color:var(--text-color);background:var(--bg-color);line-height:1.65;max-width:42rem;margin:0 auto;padding:3rem 1.5rem 2rem;transition:background-color .3s,color .3s}
        a{color:var(--accent-color);text-decoration:none;transition:color .3s} a:hover{text-decoration:underline} p{margin-bottom:1.5rem}

        .theme-toggle{width:2.5rem;height:2rem;border-radius:6px;border:1px solid var(--border-color);background:var(--bg-color);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s}
        .theme-toggle:hover{border-color:var(--accent-color)}
        .theme-toggle svg{width:16px;height:16px;stroke:var(--text-color);fill:none;stroke-width:1.5;transition:all .3s}
        .theme-toggle:hover svg{stroke:var(--accent-color)}
        .icon-colorful{opacity:0;position:absolute} .icon-original{opacity:1}
        [data-theme="colorful"] .icon-colorful{opacity:1} [data-theme="colorful"] .icon-original{opacity:0}

        header{display:flex;justify-content:space-between;align-items:center;margin-bottom:3rem}
        .header-left{display:flex;align-items:center;gap:1rem}
        .logo{font-weight:600;font-size:1rem} .logo a{color:var(--text-color)} .logo a:hover{color:var(--accent-color);text-decoration:none}
        nav ul{display:flex;gap:1.5rem;list-style:none} nav a{color:var(--text-color);font-size:1rem} nav a:hover{color:var(--accent-color);text-decoration:none} nav a.current{color:var(--accent-color);font-weight:600}

        .page-header{margin-bottom:2.5rem} .page-title{font-size:2.3rem;line-height:1.3;font-weight:700;margin-bottom:.5rem} .page-description{color:var(--muted-color);margin-bottom:0}
        @keyframes gradient-shift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
        [data-theme="colorful"] .page-description{background:linear-gradient(90deg,#16a34a,#059669,#eab308,#ea580c,#dc2626,#ea580c,#eab308,#059669,#16a34a);background-size:200% auto;background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:gradient-shift 6s ease infinite}

        .blog-card{display:block;padding:1.5rem 0;border-bottom:1px solid var(--border-color);text-decoration:none;color:inherit;transition:all .2s}
        .blog-card:hover{text-decoration:none} .blog-card:hover .blog-card-title{color:var(--accent-color)}
        [data-theme="colorful"] .blog-card{padding:1.25rem;border-radius:8px;border-bottom:none;margin-bottom:.5rem;background:transparent}
        [data-theme="colorful"] .blog-card:hover{background:linear-gradient(135deg,rgba(22,163,74,.04),rgba(234,88,12,.03) 50%,rgba(234,179,8,.03))}
        .blog-card-date{font-size:.8125rem;color:var(--muted-color);margin-bottom:.25rem;letter-spacing:.02em}
        [data-theme="colorful"] .blog-card-date{color:var(--secondary-color)}
        .blog-card-title{font-size:1.125rem;font-weight:600;line-height:1.4;margin-bottom:.375rem;transition:color .2s}
        .blog-card-excerpt{font-size:.9375rem;color:var(--muted-color);line-height:1.55;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .blog-card-excerpt.loading{height:2.4em;background:linear-gradient(90deg,var(--border-color) 25%,transparent 50%,var(--border-color) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:4px;width:80%}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        .blog-card-reading{font-size:.75rem;color:var(--muted-color);margin-top:.375rem}

        .loading-state,.error-state,.empty-state{text-align:center;padding:4rem 1rem;color:var(--muted-color)}
        .loading-state .spinner{width:24px;height:24px;border:2px solid var(--border-color);border-top-color:var(--accent-color);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 1rem}
        @keyframes spin{to{transform:rotate(360deg)}}
        .error-state{color:#dc2626} .error-state code{display:block;margin-top:.75rem;font-size:.8125rem;color:var(--muted-color);word-break:break-all}
        .sentinel{height:1px}

        .setup-banner{padding:1.25rem;border:1px dashed var(--border-color);border-radius:8px;margin-bottom:2rem;font-size:.875rem;color:var(--muted-color);line-height:1.6}
        .setup-banner code{background:rgba(0,0,0,.05);padding:.125rem .375rem;border-radius:3px;font-size:.8125rem}
        [data-theme="colorful"] .setup-banner code{background:rgba(22,163,74,.08)}

        footer{margin-top:4rem;padding-top:2rem;border-top:1px solid var(--border-color);font-size:.875rem;color:var(--muted-color);display:flex;justify-content:space-between;align-items:center}
        .footer-links{display:flex;gap:1.5rem}

        @media(max-width:640px){body{padding:2rem 1rem 1.5rem}.theme-toggle{width:2rem;height:1.75rem}.theme-toggle svg{width:14px;height:14px}header{flex-direction:column;gap:1rem}nav ul{gap:1rem}.page-title{font-size:1.75rem}footer{flex-direction:column;gap:1rem;text-align:center}[data-theme="colorful"] .blog-card{padding:1rem}}
        .theme-transition{transition:all .3s cubic-bezier(.4,0,.2,1)}
    </style>
</head>
<body class="theme-transition">
    <header>
        <div class="header-left">
            <div class="logo"><a href="/">Navajit D</a></div>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle color theme">
                <svg class="icon icon-colorful" viewBox="0 0 24 24"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/><circle cx="12" cy="12" r="2"/><path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"/></svg>
                <svg class="icon icon-original" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
            </button>
        </div>
        <nav><ul>
            <li><a href="/projects.html">Projects</a></li>
            <li><a href="/blog.html" class="current">Blog</a></li>
            <li><a href="/#experience">Experience</a></li>
        </ul></nav>
    </header>

    <div class="page-header">
        <h1 class="page-title">Blog</h1>
        <p class="page-description">Pieces on building products, personal projects, and a life beyond them.</p>
    </div>

    <div id="blogContainer">
        <div class="loading-state" id="loadingState"><div class="spinner"></div><div>Loading posts‚Ä¶</div></div>
    </div>
    <div class="sentinel" id="sentinel"></div>

    <footer>
        <div class="footer-links">
            <a href="https://github.com/navajitd">GitHub</a>
            <a href="https://linkedin.com/in/navjit-debnath-34b1b5191">LinkedIn</a>
            <a href="https://instagram.com/nav.jit">Instagram</a>
            <a href="https://twitter.com/solitary_nav">Twitter</a>
            <a href="mailto:navjitdebnath5@gmail.com">Email</a>
        </div>
        <div>¬© 2025 Navajit D</div>
    </footer>

<script>
const BLOG_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxy6I756PR-znkPfXet7QobskbzXlxoA0qHZIqq95342uhqFzl-nBmYyASKY1ZcOt5z/exec";

const POSTS_PER_BATCH = 6;
const EXCERPT_CACHE_TTL = 5 * 60 * 1000;

let allPosts = [], renderedCount = 0, isLoadingMore = false;

const themeToggle = document.getElementById('themeToggle');
const savedTheme = localStorage.getItem('theme') || 'original';
if (savedTheme === 'colorful') document.body.setAttribute('data-theme', 'colorful');
themeToggle.addEventListener('click', () => {
    const c = document.body.getAttribute('data-theme');
    if (c === 'colorful') { document.body.removeAttribute('data-theme'); localStorage.setItem('theme', 'original'); }
    else { document.body.setAttribute('data-theme', 'colorful'); localStorage.setItem('theme', 'colorful'); }
});

function getScriptUrl() { return BLOG_SCRIPT_URL || localStorage.getItem('blog_script_url') || ''; }
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
function fmtDate(iso) { return new Date(iso).toLocaleDateString('en-IN', { year:'numeric', month:'long', day:'numeric' }); }

function jsonp(url, params = {}) {
    return new Promise((resolve, reject) => {
        const cb = '__blog_' + Math.random().toString(36).slice(2);
        const u = new URL(url);
        Object.entries(params).forEach(([k, v]) => u.searchParams.set(k, v));
        u.searchParams.set('prefix', cb);
        let done = false;
        window[cb] = (data) => { if (done) return; done = true; cleanup(); resolve(data); };
        const s = document.createElement('script');
        s.src = u.toString(); s.async = true;
        s.onerror = () => { if (done) return; done = true; cleanup(); reject(new Error('Request failed')); };
        function cleanup() { try { delete window[cb]; } catch(e) {} s.remove(); }
        document.head.appendChild(s);
    });
}

function getCachedExc(id) {
    try { const r = sessionStorage.getItem('bexc_' + id); if (!r) return null; const p = JSON.parse(r); return (Date.now() - p.ts < EXCERPT_CACHE_TTL) ? p : null; } catch(e) { return null; }
}
function setCachedExc(id, d) { try { sessionStorage.setItem('bexc_' + id, JSON.stringify({ ...d, ts: Date.now() })); } catch(e) {} }

async function fetchPostList() {
    const url = getScriptUrl();
    if (!url) throw new Error('NO_URL');
    const res = await jsonp(url, { action: 'list' });
    if (!res?.ok) throw new Error(res?.error || 'Failed');
    return res.posts || [];
}
async function fetchExcerpt(id) {
    const cached = getCachedExc(id);
    if (cached) return cached;
    const url = getScriptUrl();
    if (!url) return null;
    try {
        const res = await jsonp(url, { action: 'excerpt', id });
        if (!res?.ok) return null;
        const d = { excerpt: res.excerpt || '', readTime: res.readTime || '' };
        setCachedExc(id, d);
        return d;
    } catch(e) { return null; }
}

function renderCard(post) {
    const card = document.createElement('a');
    card.className = 'blog-card';
    card.href = `/blog-post.html?id=${post.id}`;
    card.innerHTML = `
        <div class="blog-card-date">${fmtDate(post.modifiedTime)}</div>
        <div class="blog-card-title">${esc(post.title)}</div>
        <div class="blog-card-excerpt loading" data-fid="${post.id}"></div>
        <div class="blog-card-reading" data-rid="${post.id}"></div>`;
    return card;
}
function renderBatch() {
    if (renderedCount >= allPosts.length || isLoadingMore) return;
    isLoadingMore = true;
    const c = document.getElementById('blogContainer');
    const end = Math.min(renderedCount + POSTS_PER_BATCH, allPosts.length);
    for (let i = renderedCount; i < end; i++) { c.appendChild(renderCard(allPosts[i])); loadExc(allPosts[i].id); }
    renderedCount = end; isLoadingMore = false;
}
async function loadExc(id) {
    const d = await fetchExcerpt(id);
    const el = document.querySelector(`.blog-card-excerpt[data-fid="${id}"]`);
    const rl = document.querySelector(`.blog-card-reading[data-rid="${id}"]`);
    if (el) { el.classList.remove('loading'); el.textContent = d?.excerpt ? d.excerpt + (d.excerpt.length >= 240 ? '‚Ä¶' : '') : ''; }
    if (rl && d?.readTime) rl.textContent = d.readTime;
}

function showSetup() {
    document.getElementById('blogContainer').innerHTML = `<div class="setup-banner">
        <strong>Blog setup required</strong><br><br>
        1. Create a new Apps Script project and paste the code from <code>BlogProxy.gs</code><br>
        2. Deploy ‚Üí Web App (Execute as: Me, Access: Anyone)<br>
        3. Copy the deployment URL and paste it into <code>BLOG_SCRIPT_URL</code> in <code>blog.html</code> and <code>blog-post.html</code><br><br>
        Or set it once in your browser console:<br>
        <code>localStorage.setItem('blog_script_url', 'https://script.google.com/macros/s/‚Ä¶/exec')</code>
    </div>`;
}

function setupScroll() {
    new IntersectionObserver((e) => { if (e[0].isIntersecting && renderedCount < allPosts.length) renderBatch(); }, { rootMargin: '200px' }).observe(document.getElementById('sentinel'));
}

(async () => {
    if (!getScriptUrl()) { showSetup(); return; }
    try {
        allPosts = await fetchPostList();
        if (location.hash === '#latest' && allPosts.length) { location.replace(`/blog-post.html?id=${allPosts[0].id}`); return; }
        document.getElementById('loadingState')?.remove();
        if (!allPosts.length) { document.getElementById('blogContainer').innerHTML = '<div class="empty-state"><div style="font-size:1.5rem;margin-bottom:.5rem;opacity:.4">üìù</div>No posts yet.</div>'; return; }
        renderBatch(); setupScroll();
    } catch(e) {
        if (e.message === 'NO_URL') showSetup();
        else document.getElementById('blogContainer').innerHTML = `<div class="error-state">Failed to load posts<code>${esc(e.message)}</code></div>`;
    }
})();
</script>
</body>
</html>
